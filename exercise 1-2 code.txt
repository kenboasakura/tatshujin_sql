SELECT
	sex AS 性別,
	SUM(
	CASE
		WHEN sex = '1' THEN population
		WHEN sex = '2' THEN population
		ELSE 0 END
	 )
	AS 全国,
	SUM(
	CASE
		WHEN 
			sex = '1' 
		AND
			pref_name = '徳島'
		THEN population
		WHEN 
			sex = '2' 
		AND
			pref_name = '徳島'
		THEN population
		ELSE 0 END
	) 
	AS 徳島,
	SUM(
	CASE
		WHEN 
			sex = '1' 
		AND
			pref_name = '香川'
		THEN population
		WHEN 
			sex = '2' 
		AND
			pref_name = '香川'
		THEN population
		ELSE 0 END
	) 
	AS 香川,
	SUM(
	CASE
		WHEN 
			sex = '1' 
		AND
			pref_name = '愛媛'
		THEN population
		WHEN 
			sex = '2' 
		AND
			pref_name = '愛媛'
		THEN population
		ELSE 0 END
	) 
	AS 愛媛,
	SUM(
	CASE
		WHEN 
			sex = '1' 
		AND
			pref_name = '高知'
		THEN population
		WHEN 
			sex = '2' 
		AND
			pref_name = '高知'
		THEN population
		ELSE 0 END
	) 
	AS 高知,
	SUM(
	CASE
		WHEN
			sex = '1'
		AND
			pref_name IN ('徳島','香川','愛媛','高知')
		THEN population
		WHEN
			sex = '2'
		AND
			pref_name IN ('徳島','香川','愛媛','高知')
		THEN population
		ELSE 0 END
	) AS 四国
FROM
	poptbl2
GROUP BY
	sex
;

