・ウィンドウ関数
SELECT
	prc_date,
	prc_amt,
	CASE 
	WHEN COUNT(prc_date)OVER(
			ORDER BY prc_date
			/*2行間*/
			ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
		/*行数が2行以下の場合*/
		)<= 2 THEN NULL
	ELSE
	AVG(prc_amt)OVER(
			ORDER BY prc_date
			/*2行間*/
			ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
		)END AS 'AVG(prc_amt)'
FROM
	accounts
GROUP BY
	prc_date
;

・相関サブクエリ
SELECT
	a1.prc_date,
	a1.prc_amt,
	CASE
	WHEN
		(
			SELECT
				COUNT(prc_date)
			FROM
				accounts AS a2
			WHERE
				a1.prc_date >= a2.prc_date
			AND
				(
					SELECT
						COUNT(a3.prc_date)
					FROM
						accounts AS a3
					WHERE
						a3.prc_date BETWEEN a2.prc_date AND a1.prc_date
			)
		/*2行以下の場合*/
		)<= 2 THEN NULL
	ELSE
	(
		SELECT
			AVG(prc_amt)
		FROM
			accounts AS a2
		WHERE
			a1.prc_date >= a2.prc_date
		AND
			(
				SELECT
					COUNT(a3.prc_date)
				FROM
					accounts AS a3
				WHERE
					a3.prc_date BETWEEN a2.prc_date AND a1.prc_date
			/*比較する3行*/
			)<=3
	) END AS 'AVG(prc_amt)'
FROM
	accounts AS a1
ORDER BY
	prc_date ASC
;

